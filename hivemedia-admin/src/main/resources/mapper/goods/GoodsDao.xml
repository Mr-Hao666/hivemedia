<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.hivemedia.modules.goods.dao.GoodsDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="cn.hivemedia.modules.goods.entity.GoodsEntity" id="goodsMap">
        <result property="id" column="id"/>
        <result property="shopId" column="shop_id"/>
        <result property="goodsTab" column="goods_tab"/>
        <result property="name" column="name"/>
        <result property="desc" column="desc"/>
        <result property="detail" column="detail"/>
        <result property="artNo" column="art_no"/>
        <result property="keyword" column="keyword"/>
        <result property="picShow" column="pic_show"/>
        <result property="picDetail1" column="pic_detail1"/>
        <result property="picDetail2" column="pic_detail2"/>
        <result property="picDetail3" column="pic_detail3"/>
        <result property="picDetail4" column="pic_detail4"/>
        <result property="picDetail5" column="pic_detail5"/>
        <result property="releaseDate" column="release_date"/>
        <result property="brand" column="brand"/>
        <result property="genderFor" column="gender_for"/>
        <result property="salesVolume" column="sales_volume"/>
        <result property="latestDealPrice" column="latest_deal_price"/>
        <result property="unit" column="unit"/>
        <result property="weight" column="weight"/>
        <result property="inventory" column="inventory"/>
        <result property="isOnSale" column="is_on_sale"/>
        <result property="limitTimes" column="limit_times"/>
        <result property="sortNo" column="sort_no"/>
        <result property="label" column="label"/>
        <result property="createBy" column="create_by"/>
        <result property="createdTime" column="created_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updatedTime" column="updated_time"/>
        <result property="delFlag" column="del_flag"/>
        <result property="auditBy" column="audit_by"/>
        <result property="auditState" column="audit_state"/>
        <result property="auditRemark" column="audit_remark"/>
    </resultMap>
    <select id="queryGoodsVo" resultType="cn.hivemedia.modules.goods.vo.GoodsVo">
        select
        g.id,
        g.goods_tab,
        g.name,
        g.desc,
        g.keyword,
        g.art_no,
        g.pic_show,
        g.is_free_post,
        o0.url as pic_show_url,
        g.pic_detail1,
        o1.url as pic_detail1_url,
        g.pic_detail2,
        o2.url as pic_detail2_url,
        g.pic_detail3,
        o3.url as pic_detail3_url,
         g.pic_detail4,
        o4.url as pic_detail4_url,
         g.pic_detail5,
        o5.url as pic_detail5_url,
        g.base_map,
        o6.url as base_map_url,
        g.release_date,
        g.brand,
        g.gender_for,
        g.unit,
        g.is_on_sale,
        g.limit_times,
        g.sort_no,
        g.label
        from tb_goods g
        left join sys_oss o0
        on g.pic_show = o0.id
         left join sys_oss o1
        on g.pic_detail1 = o1.id
        left join sys_oss o2
        on g.pic_detail2 = o2.id
        left join sys_oss o3
        on g.pic_detail3 = o3.id
        left join sys_oss o4
        on g.pic_detail4 = o4.id
        left join sys_oss o5
        on g.pic_detail5 = o5.id
        left join sys_oss o6
        on g.base_map = o6.id
        where g.id = #{id}
    </select>

    <select id="queryGoodsVoList" resultType="cn.hivemedia.modules.goods.vo.GoodsVo">
        select
        g.id,
        (select d.value FROM sys_dict d where d.code = g.goods_tab and d.type='goodsTab') as goods_tab,
        g.name,
        g.desc,
        g.keyword,
        g.art_no,
        g.pic_show,
        g.is_free_post,
        o0.url as pic_show_url,
        g.pic_detail1,
        o1.url as pic_detail1_url,
        g.pic_detail2,
        o2.url as pic_detail2_url,
        g.pic_detail3,
        o3.url as pic_detail3_url,
        g.pic_detail4,
        o4.url as pic_detail4_url,
        g.pic_detail5,
        o5.url as pic_detail5_url,
        g.base_map,
        o6.url as base_map_url,
        g.release_date,
        g.brand,
        g.gender_for,
        g.unit,
        g.is_on_sale,
        g.limit_times,
        g.sort_no,
        g.created_time,
        g.sales_volume,
        g.latest_deal_price,
        g.updated_time,
        g.label
        from tb_goods g
        left join sys_oss o0
        on g.pic_show = o0.id
        left join sys_oss o1
        on g.pic_detail1 = o1.id
        left join sys_oss o2
        on g.pic_detail2 = o2.id
        left join sys_oss o3
        on g.pic_detail3 = o3.id
        left join sys_oss o4
        on g.pic_detail4 = o4.id
        left join sys_oss o5
        on g.pic_detail5 = o5.id
        left join sys_oss o6
        on g.base_map = o6.id
        WHERE 1=1
        <if test="goodsName != null and goodsName.trim() != ''">
            AND g.name LIKE concat('%',#{goodsName},'%')
        </if>
        <if test="artNo != null and artNo.trim() != ''">
            AND g.art_no LIKE concat('%',#{artNo},'%')
        </if>
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by g.created_time desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryTotal" resultType="java.lang.Integer">
        select count(1) from tb_goods
        WHERE 1=1
        <if test="goodsName != null and goodsName.trim() != ''">
            AND name LIKE concat('%',#{goodsName},'%')
        </if>
        <if test="artNo != null and artNo.trim() != ''">
            AND art_no LIKE concat('%',#{artNo},'%')
        </if>
    </select>

</mapper>
