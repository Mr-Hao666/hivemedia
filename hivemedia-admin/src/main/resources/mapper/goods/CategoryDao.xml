<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.hivemedia.modules.goods.dao.CategoryDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="cn.hivemedia.modules.goods.entity.CategoryEntity" id="categoryMap">
        <result property="id" column="id"/>
        <result property="pid" column="pid"/>
        <result property="picId" column="pic_id"/>
        <result property="name" column="name"/>
        <result property="sortNo" column="sort_no"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updaetBy" column="updaet_by"/>
        <result property="updateDate" column="update_date"/>
        <result property="delFlag" column="del_flag"/>
    </resultMap>



    <select id="queryCateVoList" resultType="cn.hivemedia.modules.goods.vo.CategoryVo">
        select
        cs.id,
        cs.name,
        cs.pid,
        cs.pic_id,
        cf.name as pName,
        o.url as imgUrl,
        cs.sort_no
        from tb_category cs
        left join tb_category cf
        on cs.pid = cf.id
        left join sys_oss o
        on cs.pic_id = o.id
        WHERE 1=1
        <if test="exclude != null">
            AND cs.pid != -1
        </if>
        <if test="pid != null">
            AND cs.pid = #{pid}
        </if>

        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by cs.id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryObject" resultType="cn.hivemedia.modules.goods.vo.CategoryVo">
        select
        cs.id,
        cs.name,
        cs.pid,
        cs.pic_id,
        cf.name as pName,
        o.url as imgUrl,
        cs.sort_no
        from tb_category cs
        left join tb_category cf
        on cs.pid = cf.id
        left join sys_oss o
        on cs.pic_id = o.id
        where cs.id = #{id}
    </select>


    <select id="queryTotal" resultType="java.lang.Integer">
        select count(1) from tb_category
        WHERE 1=1
        <if test="name != null and name.trim() != ''">
            AND name LIKE concat('%',#{name},'%')
        </if>
    </select>


</mapper>
