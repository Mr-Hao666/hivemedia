<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.hivemedia.modules.goods.dao.GoodsDetailDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="cn.hivemedia.modules.goods.entity.GoodsDetailEntity" id="goodsDetailMap">
        <result property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="goodsId" column="goods_id"/>
        <result property="sizeId" column="size_id"/>
        <result property="cashPledge" column="cash_pledge"/>
        <result property="curState" column="cur_state"/>
    </resultMap>


    <select id="queryGoodsDetailVoList" resultType="cn.hivemedia.modules.goods.vo.GoodsDetailsVo">
        select
        gd.id,
        gd.user_id,
        gd.size_id,
        gd.goods_id,
        gd.cash_pledge,
        gd.cur_state,
        g.name as goods_name,
        g.art_no,
        s.`desc` as size_desc
        FROM tb_goods_detail gd
        left join tb_goods g
        on g.id = gd.goods_id
        left join tb_size s
        on s.id = gd.size_id
        WHERE 1=1
        <if test="goodsName != null and goodsName.trim() != ''">
            AND g.name LIKE concat('%',#{goodsName},'%')
        </if>
        <if test="artNo != null and artNo.trim() != ''">
            AND g.art_no LIKE concat('%',#{artNo},'%')
        </if>
        <if test="goodsId != null">
            AND gd.goods_id = #{goodsId}
        </if>
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by gd.id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>
    <select id="queryTotal" resultType="java.lang.Integer">
        select count(1) from tb_goods_detail gd
        left join tb_goods g
        on g.id = gd.goods_id
        WHERE 1=1
        <if test="goodsName != null and goodsName.trim() != ''">
            AND g.name LIKE concat('%',#{goodsName},'%')
        </if>
        <if test="artNo != null and artNo.trim() != ''">
            AND g.art_no LIKE concat('%',#{artNo},'%')
        </if>
    </select>

</mapper>